{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/crypto/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\n\n// --- Fungsi Deteksi Pattern ---\nfunction detectPattern(candles) {\n  const last = candles[candles.length - 1];\n  const prev = candles[candles.length - 2];\n  const o1 = parseFloat(last[1]), h1 = parseFloat(last[2]), l1 = parseFloat(last[3]), c1 = parseFloat(last[4]);\n  const o2 = parseFloat(prev[1]), h2 = parseFloat(prev[2]), l2 = parseFloat(prev[3]), c2 = parseFloat(prev[4]);\n  const body = Math.abs(c1 - o1);\n  const totalRange = h1 - l1;\n\n  if (c2 < o2 && c1 > o1 && o1 <= c2 && c1 >= o2) return \"Bullish Engulfing ðŸš€\";\n  if (c2 > o2 && c1 < o1 && o1 >= c2 && c1 <= o2) return \"Bearish Engulfing ðŸ“‰\";\n  const lowerWick = Math.min(o1, c1) - l1;\n  const upperWick = h1 - Math.max(o1, c1);\n  if (lowerWick > body * 2 && upperWick < body) return \"Hammer ðŸ”¨\";\n  if (body <= totalRange * 0.1) return \"Doji â³\";\n  return \"Normal\";\n}\n\nexport async function GET(request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const symbol = searchParams.get('symbol')?.toUpperCase() || 'ETHUSDT';\n\n    const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=100`);\n    const candles = await res.json();\n    if (candles.code) throw new Error(\"Simbol Salah\");\n\n    const closes = candles.map(c => parseFloat(c[4]));\n    const pattern = detectPattern(candles);\n\n    const calculateRSI = (data) => {\n      let gains = 0, losses = 0;\n      for (let i = 1; i <= 14; i++) {\n        let diff = data[i] - data[i - 1];\n        if (diff >= 0) gains += diff; else losses -= diff;\n      }\n      let avgG = gains / 14, avgL = losses / 14;\n      let rsiArr = [];\n      for (let i = 15; i < data.length; i++) {\n        let diff = data[i] - data[i - 1];\n        let g = diff >= 0 ? diff : 0, l = diff < 0 ? -diff : 0;\n        avgG = (avgG * 13 + g) / 14; avgL = (avgL * 13 + l) / 14;\n        rsiArr.push(100 - (100 / (1 + avgG / avgL)));\n      }\n      return rsiArr;\n    };\n\n    const calculateEMA = (data, p) => {\n      const k = 2 / (p + 1);\n      let ema = data[0];\n      for (let i = 1; i < data.length; i++) ema = (data[i] * k) + (ema * (1 - k));\n      return ema;\n    };\n\n    const rsiData = calculateRSI(closes);\n    const stochRsi = (rsiData[rsiData.length - 1] - Math.min(...rsiData.slice(-14))) / (Math.max(...rsiData.slice(-14)) - Math.min(...rsiData.slice(-14)));\n    const ema20 = calculateEMA(closes, 20);\n    const price = closes[closes.length - 1];\n\n    let signal = \"WAIT\";\n    if (stochRsi < 0.2 && price > ema20) signal = \"STRONG BUY\";\n    else if (stochRsi > 0.8 && price < ema20) signal = \"STRONG SELL\";\n    else if (stochRsi < 0.2) signal = \"BUY (RISKY)\";\n    else if (stochRsi > 0.8) signal = \"SELL (RISKY)\";\n\n    return NextResponse.json({\n      symbol, price: price.toFixed(2), ema20: ema20.toFixed(2),\n      stochRsi: (stochRsi * 100).toFixed(2), signal, pattern,\n      trend: price > ema20 ? \"BULLISH\" : \"BEARISH\"\n    });\n  } catch (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}